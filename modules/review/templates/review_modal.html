<div id="review-modal"
    class="fixed inset-0 z-40 hidden overflow-y-auto">
    
    <div id="modal-overlay" class="fixed inset-0 z-40 bg-black bg-opacity-50"></div>

    <div class="relative z-50 flex items-center justify-center min-h-screen p-4">

        <div class="w-full max-w-lg p-6 bg-white rounded-lg shadow-xl">
            
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-semibold text-gray-800">Berikan Ulasanmu</h3>
                <button id="close-review-modal-btn"
                        class="text-gray-400 transition hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form method="POST" id="review-form" action="{% url 'review:add_review' %}" class="">
                
                {% csrf_token %}

                <input type="hidden" name="venue_id" value="{{ venue.id }}">

                <div class="w-[70%] flex flex-col">
                    <div class="flex flex-row-reverse justify-end rating-group">
                        
                        <input type="radio" id="rating-5" name="rating" value="5" class="peer hidden" required>
                        <label for="rating-5" class="star-label">★</label>
                        
                        <input type="radio" id="rating-4" name="rating" value="4" class="peer hidden">
                        <label for="rating-4" class="star-label">★</label>
                        
                        <input type="radio" id="rating-3" name="rating" value="3" class="peer hidden">
                        <label for="rating-3" class="star-label">★</label>
                        
                        <input type="radio" id="rating-2" name="rating" value="2" class="peer hidden">
                        <label for="rating-2" class="star-label">★</label>
                        
                        <input type="radio" id="rating-1" name="rating" value="1" class="peer hidden">
                        <label for="rating-1" class="star-label">★</label>
                    </div>
                </div>

                <div class="">
                    <label for="comment" class="block text-sm font-medium text-[#737373]">Tulisan Ulasan</label>
                    <textarea id="comment" name="comment" rows="4" placeholder="Tulis disini..."
                            class="w-full px-3 py-2 mt-1 text-gray-900 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 min-h-[200px]"></textarea>
                </div>

                <div class="flex justify-end mt-6 space-x-3">
                    <button id="cancel-review-btn"
                            type="button"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                        Batal
                    </button>
                    <button type="submit"
                            class="px-4 py-2 text-sm font-medium text-white bg-[#0062FF] border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Kirim Review
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .star-label {
        font-size: 2.5rem;
        color: #d1d5db;
        cursor: pointer;
        transition: color 0.2s;
    }

    .rating-group input:checked ~ .star-label {
        color: #f59e0b;
    }
</style>

<script>
    const ADD_REVIEW_ENDPOINT = `{% url 'review:add_review' %}`

    document.addEventListener('DOMContentLoaded', () => {
        const openBtn = document.getElementById('open-review-modal-btn');
        const modal = document.getElementById('review-modal');
        const overlay = document.getElementById('modal-overlay');
        const closeBtn = document.getElementById('close-review-modal-btn');
        const cancelBtn = document.getElementById('cancel-review-btn');

        
        if (openBtn) {
            openBtn.addEventListener('click', openModal);
        }
        if (closeBtn) {
            closeBtn.addEventListener('click', closeModal);
        }
        if (cancelBtn) {
            cancelBtn.addEventListener('click', closeModal);
        }
        if (overlay) {
            overlay.addEventListener('click', closeModal);
        }
    });

    const openModal = () => {
        const modal = document.getElementById('review-modal');
        if (modal) {
            modal.classList.remove('hidden')
        }
    };

    const closeModal = () => {
        const modal = document.getElementById('review-modal');
        if (modal) {
            modal.classList.add('hidden');
        }
    };

    async function addReviewEntry () {
        const modal = document.getElementById('review-modal');
        const form = document.getElementById("review-form");
        const formData = new FormData(form)

        const response = await fetch(ADD_REVIEW_ENDPOINT, {
            method: "POST",
            body: formData,
        })

        if (response.ok) {
            showToast("Review added successfully!", '', 'success');
        } else {
            showToast("An error occured.", '', "error");
        }
        document.getElementById("review-form").reset();
        modal.classList.add("hidden")
    }

    document.getElementById("review-form").addEventListener("submit", e => {
        e.preventDefault();
        addReviewEntry();
    })

    
</script>