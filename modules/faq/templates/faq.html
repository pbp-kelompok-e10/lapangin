{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'navbar.html' %}

<div class="w-full min-h-screen bg-white">
    <div class="max-w-[1280px] mx-auto px-4 md:px-20 pt-[158px] pb-16">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-[#003C9C] text-4xl font-bold font-['Poppins'] leading-10 mb-8">FAQ</h1>
            
            <!-- Category Buttons -->
            <div class="flex flex-wrap justify-center gap-3 mb-6">
                <button class="filter-btn active" onclick="filterFAQ('all')">
                    Semua
                </button>
                {% for category in categories %}
                <button class="filter-btn" onclick="filterFAQ('{{ category.0 }}')">
                    {{ category.1 }}
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Add Question -->
        {% if is_admin %}
        <div class="mb-6 flex justify-center">
            <a href="{% url 'faq:add_faq' %}" 
               class="px-6 py-2.5 bg-[#003C9C] text-white font-semibold rounded-lg hover:bg-[#002D75] transition-colors inline-flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Tambah Pertanyaan
            </a>
        </div>
        {% endif %}

        <!-- FAQ Accordion -->
        <div class="flex flex-col gap-5" id="faqAccordion">
            {% include 'faq_list.html' %}
        </div>
    </div>
</div>

<style>
    body {
        font-family: 'Poppins', sans-serif;
    }

    /* Filter Buttons */
    .filter-btn {
        padding: 0.5rem 1.5rem;
        background: white;
        color: #003C9C;
        border: 2px solid #E5E7EB;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .filter-btn:hover {
        border-color: #003C9C;
        background: #F0F9FF;
    }

    .filter-btn.active {
        background: #003C9C;
        color: white;
        border-color: #003C9C;
    }

    /* FAQ Items */
    .faq-item {
        background: white;
        border-radius: 8px;
        box-shadow: 0px 2px 5px 0px rgba(0,0,0,0.10);
        border: 1px solid #D4D4D4;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .faq-item:hover {
        box-shadow: 0px 4px 12px 0px rgba(0,60,156,0.15);
    }

    .faq-header {
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .faq-header:hover {
        background-color: #f9fafb;
    }

    .faq-question-text {
        color: #171717;
        font-size: 16px;
        font-weight: 700;
        font-family: 'Poppins', sans-serif;
        line-height: normal;
        flex: 1;
    }

    .faq-icon-wrapper {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .faq-toggle-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease;
    }

    .faq-toggle-icon svg {
        width: 20px;
        height: 8px;
        stroke: #27272A;
    }

    .faq-item.active .faq-toggle-icon {
        transform: rotate(180deg);
    }

    .faq-body {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }

    .faq-item.active .faq-body {
        max-height: 1000px;
    }

    .faq-answer {
        padding: 0 1.5rem 1.25rem 1.5rem;
        color: #171717;
        font-size: 16px;
        font-weight: 500;
        font-family: 'Poppins', sans-serif;
        line-height: normal;
    }

    /* Admin Buttons */
    .admin-buttons {
        display: flex;
        gap: 0.5rem;
        margin-right: 0.75rem;
    }

    .admin-btn {
        padding: 0.375rem 0.875rem;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
    }

    .edit-btn {
        background-color: #10B981;
        color: white;
    }

    .edit-btn:hover {
        background-color: #059669;
    }

    .delete-btn {
        background-color: #EF4444;
        color: white;
    }

    .delete-btn:hover {
        background-color: #DC2626;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .faq-header {
            padding: 1rem;
        }

        .faq-answer {
            padding: 0 1rem 1rem 1rem;
        }

        .admin-buttons {
            flex-direction: column;
            gap: 0.25rem;
        }

        .admin-btn {
            padding: 0.25rem 0.625rem;
            font-size: 11px;
        }
    }
</style>

<script>
function filterFAQ(category) {
    // Update button states
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');

    // Make AJAX request
    fetch(`{% url 'faq:filter_faq' %}?category=${category}`, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        }
    })
    .then(response => response.text())
    .then(html => {
        document.getElementById('faqAccordion').innerHTML = html;
    })
    .catch(error => console.error('Error:', error));
}

function toggleFAQ(element) {
    const faqItem = element.closest('.faq-item');
    const wasActive = faqItem.classList.contains('active');
    
    // Close all other FAQs
    document.querySelectorAll('.faq-item').forEach(item => {
        if (item !== faqItem) {
            item.classList.remove('active');
        }
    });
    
    // Toggle current FAQ
    if (wasActive) {
        faqItem.classList.remove('active');
    } else {
        faqItem.classList.add('active');
    }
}

function confirmDelete(faqId, question) {
    if (confirm(`Apakah Anda yakin ingin menghapus FAQ: "${question}"?`)) {
        window.location.href = `{% url 'faq:delete_faq' 0 %}`.replace('0', faqId);
    }
}
</script>
{% endblock %}