<nav class="fixed top-0 w-full bg-white shadow-md z-50">
    <div class="mx-auto px-2 md:px-5 lg:px-16">
        <div class="flex justify-between h-20 items-center">

            <div class="flex items-center">
                <a href="{% url 'main:show_main' %}" class="flex-shrink-0 flex items-center">
                    <svg class="h-8 md:h-12" viewBox="0 0 40 53" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.65506 27.875C4.65522 36.375 14.059 46.2757 19.9051 52.25C31.1501 39.6013 36.2565 33.4097 38.03 27.875C39.9526 21.875 40.4868 17.715 38.03 11.5C34.0717 4.5 30.059 0.750559 19.9051 0C9.98728 0.990796 5.02994 4.5 1.65506 11.375C1.65506 11.375 -1.3451 19.375 1.65506 27.875Z" fill="#0062FF"/>
                        <path d="M22.8217 10.75H17.4467C15.4443 14.1217 13.9013 15.7428 10.3217 18.125V23.5C13.8004 25.2446 15.3383 26.6351 17.0717 30.125H22.8217C24.7144 26.808 26.3083 25.4097 29.8217 23.5V18.125C26.3202 15.9146 24.8234 14.2686 22.8217 10.75Z" fill="#F9F9F9"/>
                        <path d="M17.0717 24.25L15.6967 18.625L19.9467 15.5L24.1967 18.625L22.8217 24.25H17.0717Z" fill="#0062FF"/>
                        <circle cx="19.9467" cy="20.375" r="12.875" stroke="white" stroke-width="2"/>
                    </svg>
                    <span class="ml-3 text-xl lg:text-5xl font-bold text-[#0062FF]">LAPANG<span class="text-[#99FF00]">IN</span></span>
                </a>
            </div>

            <div class="hidden md:flex space-x-[60px] lg:space-x-[70px] flex items-center">
                <a href="{% url 'main:about' %}" class="text-[#737373] text-sm hover:text-gray-900 inline-flex items-center font-bold lg:text-base">Tentang</a>
                <a href="{% url 'venue:search_venue' %}" class="text-[#737373] text-sm inline-flex items-center font-bold lg:text-base">Sewa Stadion</a>
                <a href="#" class="text-[#737373] text-sm lg:text-base font-bold">FAQ</a>
            </div>

            <div class="flex items-center">
                <div class="hidden md:flex" id="nav-auth"></div>
                
                <div class="md:hidden flex items-center ml-4">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
                        <span class="sr-only">Open main menu</span>
                        <svg id="hamburger-open" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <svg id="hamburger-close" class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>

        </div>
    </div>

    <div class="md:hidden hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            <a href="{% url 'main:about' %}" class="text-[#737373] hover:text-gray-900 block px-3 py-2 rounded-md text-base font-bold">Tentang</a>
            <a href="{% url 'venue:search_venue' %}" class="text-[#737373] block px-3 py-2 rounded-md text-base font-bold">Sewa Stadion</a>
            <a href="#" class="text-[#737373] block px-3 py-2 rounded-md text-base font-bold">FAQ</a>
        </div>
        <div class="pt-4 pb-3 border-t border-gray-200" id="nav-auth-mobile">
        </div>
    </div>
</nav>


<script>
    const LOGIN_LINK = "{% url 'accounts:login' %}";
    const REGISTER_LINK = "{% url 'accounts:register' %}";
    const LOGOUT_LINK = "{% url 'accounts:logout' %}"
    const PAGE_DATA_API_ENDPOINT = "{% url 'accounts:get_page_data' %}"
    
    const nav_auth = document.getElementById('nav-auth');
    const nav_auth_mobile = document.getElementById("nav-auth-mobile");

    async function initializeNavbar() {
        try {
            const response = await fetch(PAGE_DATA_API_ENDPOINT);
            const userData = await response.json();
            renderAuthButtons(userData);
        } catch (error) {
            console.error("Failed to initialize navbar");
            renderAuthButtons(null);
        }
    }

    function renderAuthButtons(userData) {
        let desktopHtml = '';
        let mobileHtml = '';

        if (userData && userData.is_authenticated) {
            const username = userData.username || userData.name;
            desktopHtml = `
                <div class="relative">
                    <button id="user-menu-trigger" class="flex items-center space-x-6 font-bold text-[#737373] hover:text-[#4B4B4B] flex gap-2">
                        Selamat Datang, ${username}
                        <svg id="arrow-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#808080" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-200">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    
                    <div id="user-menu-dropdown" class="hidden absolute right-0 mt-10 w-48 bg-white rounded-lg shadow-lg border border-gray-300 z-10">
                        <a href="#" class="flex gap-3 border-b border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 21C1.99986 19.7062 2.31352 18.4316 2.91408 17.2857C3.51464 16.1397 4.38419 15.1565 5.44815 14.4203C6.51212 13.6842 7.73876 13.217 9.02288 13.059C10.307 12.901 11.6103 13.0568 12.821 13.513M21.378 16.626C21.7764 16.2276 22.0001 15.6874 22.0001 15.124C22.0001 14.5606 21.7764 14.0204 21.378 13.622C20.9796 13.2236 20.4394 12.9999 19.876 12.9999C19.3126 12.9999 18.7724 13.2236 18.374 13.622L14.364 17.634C14.1262 17.8716 13.9522 18.1653 13.858 18.488L13.021 21.358C12.9959 21.444 12.9944 21.5353 13.0166 21.6221C13.0389 21.7089 13.0841 21.7882 13.1474 21.8516C13.2108 21.9149 13.2901 21.9601 13.3769 21.9824C13.4637 22.0046 13.555 22.0031 13.641 21.978L16.511 21.141C16.8337 21.0468 17.1274 20.8728 17.365 20.635L21.378 16.626ZM15 8C15 10.7614 12.7614 13 10 13C7.23858 13 5 10.7614 5 8C5 5.23858 7.23858 3 10 3C12.7614 3 15 5.23858 15 8Z" stroke="#737373" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <span>Profil</span>
                        </a>
                        <a href="#" class="flex items-center border-b border-gray-300 gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 3.00003H4C3.44772 3.00003 3 3.44775 3 4.00003V11C3 11.5523 3.44772 12 4 12H9C9.55228 12 10 11.5523 10 11V4.00003C10 3.44775 9.55228 3.00003 9 3.00003Z" stroke="#737373" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 3.00003H15C14.4477 3.00003 14 3.44775 14 4.00003V7.00003C14 7.55232 14.4477 8.00003 15 8.00003H20C20.5523 8.00003 21 7.55232 21 7.00003V4.00003C21 3.44775 20.5523 3.00003 20 3.00003Z" stroke="#737373" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 12H15C14.4477 12 14 12.4477 14 13V20C14 20.5523 14.4477 21 15 21H20C20.5523 21 21 20.5523 21 20V13C21 12.4477 20.5523 12 20 12Z" stroke="#737373" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 16H4C3.44772 16 3 16.4477 3 17V20C3 20.5523 3.44772 21 4 21H9C9.55228 21 10 20.5523 10 20V17C10 16.4477 9.55228 16 9 16Z" stroke="#737373" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <span>Dashboard</span>
                        </a>
                        <a href="#" class="logout-btn flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 17.0001L21 12.0001M21 12.0001L16 7.00006M21 12.0001H9M9 21.0001H5C4.46957 21.0001 3.96086 20.7893 3.58579 20.4143C3.21071 20.0392 3 19.5305 3 19.0001V5.00006C3 4.46963 3.21071 3.96092 3.58579 3.58585C3.96086 3.21077 4.46957 3.00006 5 3.00006H9" stroke="#E7000B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <span>Keluar</span>
                        </a>
                    </div>
                </div>`;
            
            mobileHtml = `
                <div class="px-5">
                    <div class="font-medium text-[#737373]">Welcome, ${username}</div>
                </div>
                <div class="mt-3 px-2 space-y-1">
                    <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#737373] hover:text-white hover:bg-blue-500">Profil</a>
                    <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#737373] hover:text-white hover:bg-blue-500">Dashboard</a>
                    <a href="#" class="logout-btn block px-3 py-2 rounded-md text-base font-medium text-[#E7000B] hover:bg-red-50">Keluar</a>
                </div>`;
        } else {
            desktopHtml = `
                <div class="flex items-center space-x-3">
                    <a href="${LOGIN_LINK}" class="text-gray-500 py-5 px-8 hover:text-gray-900 font-bold text-base">Masuk</a>
                    <a href="${REGISTER_LINK}" class="inline-flex items-center justify-center py-5 px-8 rounded-lg text-white bg-[#0062FF] hover:bg-blue-700 font-bold text-base">Daftar</a>
                </div>`;
            
            mobileHtml = `
                <div class="px-2 space-y-1">
                    <a href="${LOGIN_LINK}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-100">Masuk</a>
                    <a href="${REGISTER_LINK}" class="block px-3 py-2 rounded-md text-base font-medium text-white bg-[#0062FF] hover:bg-blue-700">Daftar</a>
                </div>`;
        }
        
        if (nav_auth) nav_auth.innerHTML = desktopHtml;
        if (nav_auth_mobile) nav_auth_mobile.innerHTML = mobileHtml;
        
        if (userData && userData.is_authenticated) {
            const userMenuTrigger = document.getElementById("user-menu-trigger");
            const userMenuDropDown = document.getElementById("user-menu-dropdown");
            
            userMenuTrigger.addEventListener("click", (e) => {
                e.preventDefault();
                userMenuDropDown.classList.toggle("hidden");
                userMenuTrigger.querySelector("svg").classList.toggle("rotate-180");
                userMenuTrigger.classList.toggle("text-[#737373]")
                userMenuTrigger.classList.toggle("hover:text-[#4B4B4B]")
                userMenuTrigger.classList.toggle("text-[#0062FF]")
            });
        }
        
        document.querySelectorAll('.logout-btn').forEach(btn => {
            btn.addEventListener('click', async function (e) {
                e.preventDefault();
                try {
                    const response = await fetch(LOGOUT_LINK, { method: 'POST', headers: { 'Accepts': 'application/json' }});
                    if (response.ok) {
                        showToast("You have been logged out.", "", "success");
                        console.log("Logout successful");
                        setTimeout(() => { window.location.href = LOGIN_LINK; }, 750);
                    } else {
                        showToast('Logout failed, please try again', "", "error");
                        console.error("Logout failed");
                    }
                } catch (error) {
                    console.error("Error during logout: ", error);
                }
            });
        });
    }

    function highlightActiveLink() {
        const currentPath = window.location.pathname;
        const activeClass = 'text-[#0062FF]';
        const inactiveClass = 'text-[#737373]';

        const navLinks = document.querySelectorAll('nav a[href]:not([href="#"])');

        navLinks.forEach(link => {
            if (new URL(link.href).pathname === currentPath) {
                link.classList.remove(inactiveClass);
                link.classList.add(activeClass);
            } else {
                link.classList.remove(activeClass);
                link.classList.add(inactiveClass);
            }
        });
    }

    window.addEventListener('DOMContentLoaded', () => {
        initializeNavbar();
        highlightActiveLink();

        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const openIcon = document.getElementById('hamburger-open');
        const closeIcon = document.getElementById('hamburger-close');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
            openIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
        });
    });
</script>